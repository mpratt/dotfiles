#!/bin/bash
##################################################################
#  Script que muestra Juegos para Gameboy y los ejecuta
#  Michael Pratt <pratt@hablarmierda.net>
##################################################################
GAMEDIR="/home/pratt/Games/Gameboy"
EMULATORDIR="/mnt/data/Archive/Linux/apps/VisualBoyAdvance"
TMPDIR=$(mktemp -d -t GameBoyShit.XXXXXX)

# Clean me up!
trap "rm -rf ${TMPDIR} && exit 0" 0 1 2 9 5 15
echo "Searching for Games"
find "${GAMEDIR}" -type f -maxdepth 1 -iname "*.gb*" -printf "\"%P\" \"\" off \n" | sort > ${TMPDIR}/file_search

if [ "$(stat -c%s ${TMPDIR}/file_search)" -eq 0 ]; then
    echo "No Games Found"
    exit 0
fi

dialog --clear --title "$APPNAME - $VERSION" \
       --backtitle "GameBoy Wrapper" \
       --radiolist "What game do you want to play?" 15 110 15 \
       --file ${TMPDIR}/file_search 2> ${TMPDIR}/game

if [ "$(stat -c%s ${TMPDIR}/game)" -eq 0 ]; then
    echo "No Games Selected"
    exit 0
fi

NAME=$(cat ${TMPDIR}/game)
cd "${EMULATORDIR}"
VisualBoyAdvance -4 "${GAMEDIR}/${NAME}"
